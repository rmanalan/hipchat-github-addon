(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.AP = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _ap = _dereq_('./ap');

var _ap2 = _interopRequireDefault(_ap);

module.exports = new _ap2['default']();

},{"./ap":4}],2:[function(_dereq_,module,exports){
"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var _util = _dereq_('./util');

var _util2 = _interopRequireDefault(_util);

var PostMessage = (function () {
  function PostMessage(data) {
    _classCallCheck(this, PostMessage);

    var d = data || {};
    this._registerListener(d.listenOn);
  }

  // listen for postMessage events (defaults to window).

  _createClass(PostMessage, [{
    key: "_registerListener",
    value: function _registerListener(listenOn) {
      if (!listenOn || !listenOn.addEventListener) {
        listenOn = window;
      }
      listenOn.addEventListener("message", _util2["default"]._bind(this, this._receiveMessage), false);
    }
  }, {
    key: "_receiveMessage",
    value: function _receiveMessage(event) {
      var extensionId = event.data.eid,
          reg = undefined;

      if (extensionId && this._registeredExtensions) {
        reg = this._registeredExtensions[extensionId];
      }

      if (!this._checkOrigin(event, reg)) {
        return false;
      }

      var handler = this._messageHandlers[event.data.type];
      if (handler) {
        handler.call(this, event, reg);
      }
    }
  }]);

  return PostMessage;
})();

module.exports = PostMessage;

},{"./util":3}],3:[function(_dereq_,module,exports){
"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var LOG_PREFIX = "[Simple-XDM] ";

var Util = (function () {
  function Util() {
    _classCallCheck(this, Util);
  }

  _createClass(Util, [{
    key: "locationOrigin",
    value: function locationOrigin() {
      if (!window.location.origin) {
        return window.location.protocol + "//" + window.location.hostname + (window.location.port ? ':' + window.location.port : '');
      } else {
        return window.location.origin;
      }
    }
  }, {
    key: "randomString",
    value: function randomString() {
      return Math.floor(Math.random() * 1000000000).toString(16);
    }
  }, {
    key: "isString",
    value: function isString(str) {
      return typeof str === "string" || str instanceof String;
    }

    // might be un-needed
  }, {
    key: "argumentsToArray",
    value: function argumentsToArray(arrayLike) {
      var array = [];
      for (var i = 0; i < arrayLike.length; i++) {
        array.push(arrayLike[i]);
      }
      return array;
    }
  }, {
    key: "hasCallback",
    value: function hasCallback(args) {
      var length = args.length;
      return length > 0 && typeof args[length - 1] === 'function';
    }
  }, {
    key: "error",
    value: function error(msg) {
      if (window.console) {
        console.error(LOG_PREFIX + msg);
      }
    }
  }, {
    key: "warn",
    value: function warn(msg) {
      if (window.console) {
        console.warn(LOG_PREFIX + msg);
      }
    }
  }, {
    key: "_bind",
    value: function _bind(thisp, fn) {
      if (Function.prototype.bind) {
        return fn.bind(thisp);
      }
      return function () {
        return fn.apply(thisp, arguments);
      };
    }
  }, {
    key: "each",
    value: function each(o, it) {
      var l;
      var k;
      if (o) {
        l = o.length;
        if (l != null && typeof o !== 'function') {
          k = 0;
          while (k < l) {
            if (it.call(o[k], k, o[k]) === false) {
              break;
            }
            k += 1;
          }
        } else {
          for (k in o) {
            if (o.hasOwnProperty(k)) {
              if (it.call(o[k], k, o[k]) === false) {
                break;
              }
            }
          }
        }
      }
    }
  }, {
    key: "extend",
    value: function extend(dest) {
      var args = arguments;
      var srcs = [].slice.call(args, 1, args.length);
      srcs.forEach(function (source) {
        Object.getOwnPropertyNames(source).forEach(function (name) {
          dest[name] = source[name];
        });
      });
      return dest;
    }
  }]);

  return Util;
})();

module.exports = new Util();

},{}],4:[function(_dereq_,module,exports){
'use strict';

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ('value' in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

var _get = function get(_x, _x2, _x3) { var _again = true; _function: while (_again) { var object = _x, property = _x2, receiver = _x3; _again = false; if (object === null) object = Function.prototype; var desc = Object.getOwnPropertyDescriptor(object, property); if (desc === undefined) { var parent = Object.getPrototypeOf(object); if (parent === null) { return undefined; } else { _x = parent; _x2 = property; _x3 = receiver; _again = true; desc = parent = undefined; continue _function; } } else if ('value' in desc) { return desc.value; } else { var getter = desc.get; if (getter === undefined) { return undefined; } return getter.call(receiver); } } };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError('Cannot call a class as a function'); } }

function _inherits(subClass, superClass) { if (typeof superClass !== 'function' && superClass !== null) { throw new TypeError('Super expression must either be null or a function, not ' + typeof superClass); } subClass.prototype = Object.create(superClass && superClass.prototype, { constructor: { value: subClass, enumerable: false, writable: true, configurable: true } }); if (superClass) Object.setPrototypeOf ? Object.setPrototypeOf(subClass, superClass) : subClass.__proto__ = superClass; }

var _commonUtil = _dereq_('../common/util');

var _commonUtil2 = _interopRequireDefault(_commonUtil);

var _commonPostmessage = _dereq_('../common/postmessage');

var _commonPostmessage2 = _interopRequireDefault(_commonPostmessage);

var _dollar = _dereq_('./dollar');

var _dollar2 = _interopRequireDefault(_dollar);

var _size = _dereq_('./size');

var _size2 = _interopRequireDefault(_size);

var _resizeListener = _dereq_('./resize-listener');

var _resizeListener2 = _interopRequireDefault(_resizeListener);

var _configurationOptions = _dereq_('./configuration-options');

var _configurationOptions2 = _interopRequireDefault(_configurationOptions);

var _consumerOptions = _dereq_('./consumer-options');

var _consumerOptions2 = _interopRequireDefault(_consumerOptions);

var AP = (function (_PostMessage) {
  _inherits(AP, _PostMessage);

  function AP(options) {
    _classCallCheck(this, AP);

    _get(Object.getPrototypeOf(AP.prototype), 'constructor', this).call(this);
    _configurationOptions2['default'].set(options);
    this._data = this._parseInitData();
    _configurationOptions2['default'].set(this._data.options);
    this._host = window.parent;
    this._hostModules = {};
    this._eventHandlers = {};
    this._pendingCallbacks = {};
    this._setupAPI(this._data.api);
    this._setupAPIWithoutRequire(this._data.api);
    this._messageHandlers = {
      resp: this._handleResponse,
      evt: this._handleEvent
    };
    (0, _dollar2['default'])(_commonUtil2['default']._bind(this, this._autoResizer));
    this._sendInit();
  }

  _createClass(AP, [{
    key: '_autoResizer',
    value: function _autoResizer() {
      this._enableAutoResize = Boolean(_configurationOptions2['default'].get('autoresize'));
      if (_consumerOptions2['default'].get('resize') === false) {
        this._enableAutoResize = false;
      }
      if (this._enableAutoResize) {
        this._initResize();
      }
    }

    /**
    * The initialization data is passed in when the iframe is created as its 'name' attribute.
    * Example:
    * {
    *   extension_id: The ID of this iframe as defined by the host
    *   origin: 'https://example.org'  // The parent's window origin
    *   api: {
    *     _globals: { ... },
    *     messages = {
    *       clear: {},
    *       ...
    *     },
    *     ...
    *   }
    * }
    **/
  }, {
    key: '_parseInitData',
    value: function _parseInitData(data) {
      try {
        return JSON.parse(data || window.name);
      } catch (e) {
        return {};
      }
    }
  }, {
    key: '_createModule',
    value: function _createModule(moduleName, api) {
      var _this = this;

      return Object.getOwnPropertyNames(api).reduce(function (accumulator, functionName) {
        accumulator[functionName] = _this._createMethodHandler({
          mod: moduleName,
          fn: functionName
        });
        return accumulator;
      }, {});
    }
  }, {
    key: '_setupAPI',
    value: function _setupAPI(api) {
      var _this2 = this;

      this._hostModules = Object.getOwnPropertyNames(api).reduce(function (accumulator, moduleName) {
        accumulator[moduleName] = _this2._createModule(moduleName, api[moduleName]);
        return accumulator;
      }, {});

      Object.getOwnPropertyNames(this._hostModules._globals || {}).forEach(function (global) {
        _this2[global] = _this2._hostModules._globals[global];
      });
    }
  }, {
    key: '_setupAPIWithoutRequire',
    value: function _setupAPIWithoutRequire(api) {
      var _this3 = this;

      Object.getOwnPropertyNames(api).forEach(function (moduleName) {
        if (typeof _this3[moduleName] !== "undefined") {
          throw new Error('XDM module: ' + moduleName + ' will collide with existing variable');
        }
        _this3[moduleName] = _this3._createModule(moduleName, api[moduleName]);
      }, this);
    }
  }, {
    key: '_pendingCallback',
    value: function _pendingCallback(mid, fn) {
      this._pendingCallbacks[mid] = fn;
    }
  }, {
    key: '_createMethodHandler',
    value: function _createMethodHandler(methodData) {
      var methodHandler = function methodHandler() {
        var mid = undefined,
            args = _commonUtil2['default'].argumentsToArray(arguments);
        if (_commonUtil2['default'].hasCallback(args)) {
          mid = _commonUtil2['default'].randomString();
          this._pendingCallback(mid, args.pop());
        }
        this._host.postMessage({
          eid: this._data.extension_id,
          type: 'req',
          mid: mid,
          mod: methodData.mod,
          fn: methodData.fn,
          args: args
        }, this._data.origin);
      };

      return _commonUtil2['default']._bind(this, methodHandler);
    }
  }, {
    key: '_handleResponse',
    value: function _handleResponse(event) {
      var data = event.data;
      var pendingCallback = this._pendingCallbacks[data.mid];
      if (pendingCallback) {
        delete this._pendingCallbacks[data.mid];
        pendingCallback.apply(window, data.args);
      }
    }
  }, {
    key: '_handleEvent',
    value: function _handleEvent(event) {
      var sendResponse = function sendResponse() {
        var args = _commonUtil2['default'].argumentsToArray(arguments);
        event.source.postMessage({
          eid: this._data.extension_id,
          mid: event.data.mid,
          type: 'resp',
          args: args
        }, this._data.origin);
      };
      sendResponse = _commonUtil2['default']._bind(this, sendResponse);
      var data = event.data;
      var handler = this._eventHandlers[data.etyp];
      if (handler) {
        handler(data.evnt, sendResponse);
      } else if (data.mid) {
        sendResponse();
      }
    }
  }, {
    key: '_checkOrigin',
    value: function _checkOrigin(event) {
      return event.origin === this._data.origin && event.source === this._host;
    }
  }, {
    key: '_sendInit',
    value: function _sendInit() {
      this._host.postMessage({
        eid: this._data.extension_id,
        type: 'init'
      }, this._data.origin);
    }
  }, {
    key: 'broadcast',
    value: function broadcast(event, evnt) {
      if (!_commonUtil2['default'].isString(event)) {
        throw new Error("Event type must be string");
      }

      this._host.postMessage({
        eid: this._data.extension_id,
        type: 'broadcast',
        etyp: event,
        evnt: evnt
      }, this._data.origin);
    }
  }, {
    key: 'require',
    value: function _dereq_(modules, callback) {
      var _this4 = this;

      var requiredModules = Array.isArray(modules) ? modules : [modules],
          args = requiredModules.map(function (module) {
        return _this4._hostModules[module];
      });
      callback.apply(window, args);
    }
  }, {
    key: 'register',
    value: function register(handlers) {
      this._eventHandlers = handlers || {};
      this._host.postMessage({
        eid: this._data.extension_id,
        type: 'event_query',
        args: Object.getOwnPropertyNames(handlers)
      }, this._data.origin);
    }
  }, {
    key: '_initResize',
    value: function _initResize() {
      var resize = _commonUtil2['default']._bind(this, function () {
        var dimensions = (0, _size2['default'])();
        this.require('env', function (env) {
          if (env && env.resize) {
            env.resize(dimensions.w, dimensions.h);
          }
        });
      });

      resize();
      _resizeListener2['default'].add(resize);
    }
  }]);

  return AP;
})(_commonPostmessage2['default']);

module.exports = AP;

},{"../common/postmessage":2,"../common/util":3,"./configuration-options":5,"./consumer-options":6,"./dollar":8,"./resize-listener":9,"./size":10}],5:[function(_dereq_,module,exports){
/**
* Extension wide configuration values
*/
"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var ConfigurationOptions = (function () {
  function ConfigurationOptions() {
    _classCallCheck(this, ConfigurationOptions);

    this.options = {};
  }

  _createClass(ConfigurationOptions, [{
    key: "_flush",
    value: function _flush() {
      this.options = {};
    }
  }, {
    key: "get",
    value: function get(item) {
      return item ? this.options[item] : this.options;
    }
  }, {
    key: "set",
    value: function set(data, value) {
      var _this = this;

      if (!data) {
        return;
      }

      if (value) {
        data = _defineProperty({}, data, value);
      }
      var keys = Object.getOwnPropertyNames(data);
      keys.forEach(function (key) {
        _this.options[key] = data[key];
      }, this);
    }
  }]);

  return ConfigurationOptions;
})();

module.exports = new ConfigurationOptions();

},{}],6:[function(_dereq_,module,exports){
"use strict";

var _createClass = (function () { function defineProperties(target, props) { for (var i = 0; i < props.length; i++) { var descriptor = props[i]; descriptor.enumerable = descriptor.enumerable || false; descriptor.configurable = true; if ("value" in descriptor) descriptor.writable = true; Object.defineProperty(target, descriptor.key, descriptor); } } return function (Constructor, protoProps, staticProps) { if (protoProps) defineProperties(Constructor.prototype, protoProps); if (staticProps) defineProperties(Constructor, staticProps); return Constructor; }; })();

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

function _classCallCheck(instance, Constructor) { if (!(instance instanceof Constructor)) { throw new TypeError("Cannot call a class as a function"); } }

var _dollar = _dereq_('./dollar');

var _dollar2 = _interopRequireDefault(_dollar);

var ConsumerOptions = (function () {
  function ConsumerOptions() {
    _classCallCheck(this, ConsumerOptions);
  }

  _createClass(ConsumerOptions, [{
    key: "_getConsumerOptions",
    value: function _getConsumerOptions() {
      var options = {},
          $script = (0, _dollar2["default"])("script[src*='/atlassian-connect/all']");

      if (!($script && /\/atlassian-connect\/all(-debug)?\.js($|\?)/.test($script.attr("src")))) {
        $script = (0, _dollar2["default"])("#ac-iframe-options");
      }

      if ($script && $script.length > 0) {
        // get its data-options attribute, if any
        var optStr = $script.attr("data-options");
        if (optStr) {
          // if found, parse the value into kv pairs following the format of a style element
          optStr.split(";").forEach(function (nvpair) {
            nvpair = nvpair.trim();
            if (nvpair) {
              var nv = nvpair.split(":"),
                  k = nv[0].trim(),
                  v = nv[1].trim();
              if (k && v != null) {
                options[k] = v === "true" || v === "false" ? v === "true" : v;
              }
            }
          });
        }
      }

      return options;
    }
  }, {
    key: "_flush",
    value: function _flush() {
      delete this._options;
    }
  }, {
    key: "get",
    value: function get(key) {
      if (!this._options) {
        this._options = this._getConsumerOptions();
      }
      if (key) {
        return this._options[key];
      }
      return this._options;
    }
  }]);

  return ConsumerOptions;
})();

module.exports = new ConsumerOptions();

},{"./dollar":8}],7:[function(_dereq_,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _dollar = _dereq_('./dollar');

var _dollar2 = _interopRequireDefault(_dollar);

function getContainer() {
  // Look for these two selectors first... you need these to allow for the auto-shrink to work
  // Otherwise, it'll default to document.body which can't auto-grow or auto-shrink
  var container = (0, _dollar2['default'])('.ac-content, #content');
  return container.length > 0 ? container[0] : document.body;
}

module.exports = getContainer;

},{"./dollar":8}],8:[function(_dereq_,module,exports){
'use strict';

Object.defineProperty(exports, '__esModule', {
  value: true
});

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _commonUtil = _dereq_('../common/util');

var _commonUtil2 = _interopRequireDefault(_commonUtil);

var _each = _commonUtil2['default'].each,
    document = window.document;

function $(sel, context) {

  context = context || document;

  var els = [];
  if (sel) {
    if (typeof sel === 'string') {
      var results = context.querySelectorAll(sel),
          arr_results = Array.prototype.slice.call(results);
      Array.prototype.push.apply(els, arr_results);
    } else if (sel.nodeType === 1) {
      els.push(sel);
    } else if (sel === window) {
      els.push(sel);
    } else if (typeof sel === 'function') {
      onDomLoad(sel);
    }
  }

  _commonUtil2['default'].extend(els, {
    each: function each(it) {
      _each(this, it);
      return this;
    },
    bind: function bind(name, callback) {
      this.each(function (i, el) {
        this.bind(el, name, callback);
      });
    },
    attr: function attr(k) {
      var v;
      this.each(function (i, el) {
        v = el[k] || el.getAttribute && el.getAttribute(k);
        return !v;
      });
      return v;
    },
    removeClass: function removeClass(className) {
      return this.each(function (i, el) {
        if (el.className) {
          el.className = el.className.replace(new RegExp('(^|\\s)' + className + '(\\s|$)'), ' ');
        }
      });
    },
    html: function html(_html) {
      return this.each(function (i, el) {
        el.innerHTML = _html;
      });
    },
    append: function append(spec) {
      return this.each(function (i, to) {
        var el = context.createElement(spec.tag);
        _each(spec, function (k, v) {
          if (k === '$text') {
            if (el.styleSheet) {
              // style tags in ie
              el.styleSheet.cssText = v;
            } else {
              el.appendChild(context.createTextNode(v));
            }
          } else if (k !== 'tag') {
            el[k] = v;
          }
        });
        to.appendChild(el);
      });
    }
  });

  return els;
}

function binder(std, odd) {
  std += 'EventListener';
  odd += 'Event';
  return function (el, e, fn) {
    if (el[std]) {
      el[std](e, fn, false);
    } else if (el[odd]) {
      el[odd]('on' + e, fn);
    }
  };
}

$.bind = binder('add', 'attach');
$.unbind = binder('remove', 'detach');

function onDomLoad(func) {
  var w = window,
      readyState = w.document.readyState;

  if (readyState === "interactive" || readyState === "complete") {
    func.call(w);
  } else {
    $.bind(w, "load", function () {
      func.call(w);
    });
  }
}

exports['default'] = $;
module.exports = exports['default'];

},{"../common/util":3}],9:[function(_dereq_,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _documentContainer = _dereq_('./document-container');

var _documentContainer2 = _interopRequireDefault(_documentContainer);

function EventQueue() {
    this.q = [];
    this.add = function (ev) {
        this.q.push(ev);
    };

    var i, j;
    this.call = function () {
        for (i = 0, j = this.q.length; i < j; i++) {
            this.q[i].call();
        }
    };
}

function attachResizeEvent(element, resized) {
    if (!element.resizedAttached) {
        element.resizedAttached = new EventQueue();
        element.resizedAttached.add(resized);
    } else if (element.resizedAttached) {
        element.resizedAttached.add(resized);
        return;
    }

    element.resizeSensor = document.createElement('div');
    element.resizeSensor.className = 'ac-resize-sensor';
    var style = 'position: absolute; left: 0; top: 0; right: 0; bottom: 0; overflow: scroll; z-index: -1; visibility: hidden;';
    var styleChild = 'position: absolute; left: 0; top: 0;';

    element.resizeSensor.style.cssText = style;
    element.resizeSensor.innerHTML = '<div class="ac-resize-sensor-expand" style="' + style + '">' + '<div style="' + styleChild + '"></div>' + '</div>' + '<div class="ac-resize-sensor-shrink" style="' + style + '">' + '<div style="' + styleChild + ' width: 200%; height: 200%"></div>' + '</div>';
    element.appendChild(element.resizeSensor);

    if (getComputedStyle(element).position === 'static') {
        element.style.position = 'relative';
    }

    var expand = element.resizeSensor.childNodes[0];
    var expandChild = expand.childNodes[0];
    var shrink = element.resizeSensor.childNodes[1];

    var lastWidth, lastHeight;

    var reset = function reset() {
        expandChild.style.width = expand.offsetWidth + 10 + 'px';
        expandChild.style.height = expand.offsetHeight + 10 + 'px';
        expand.scrollLeft = expand.scrollWidth;
        expand.scrollTop = expand.scrollHeight;
        shrink.scrollLeft = shrink.scrollWidth;
        shrink.scrollTop = shrink.scrollHeight;
        lastWidth = element.offsetWidth;
        lastHeight = element.offsetHeight;
    };

    reset();

    var changed = function changed() {
        if (element.resizedAttached) {
            element.resizedAttached.call();
        }
    };

    var onScroll = function onScroll() {
        if (element.offsetWidth !== lastWidth || element.offsetHeight !== lastHeight) {
            changed();
        }
        reset();
    };

    expand.addEventListener('scroll', onScroll);
    shrink.addEventListener('scroll', onScroll);
}

module.exports = {
    add: function add(fn) {
        var container = (0, _documentContainer2['default'])();
        attachResizeEvent(container, fn);
    },
    remove: function remove() {
        var container = (0, _documentContainer2['default'])();
        if (container.resizeSensor) {
            container.removeChild(container.resizeSensor);
            delete container.resizeSensor;
            delete container.resizedAttached;
        }
    }
};

},{"./document-container":7}],10:[function(_dereq_,module,exports){
'use strict';

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { 'default': obj }; }

var _documentContainer = _dereq_('./document-container');

var _documentContainer2 = _interopRequireDefault(_documentContainer);

var size = function size(width, height, container) {
  var w = width == null ? '100%' : width,
      h,
      docHeight;

  if (!container) {
    container = (0, _documentContainer2['default'])();
  }

  if (height) {
    h = height;
  } else {
    // Determine height
    docHeight = Math.max(container.scrollHeight, document.documentElement.scrollHeight, container.offsetHeight, document.documentElement.offsetHeight, container.clientHeight, document.documentElement.clientHeight);

    if (container === document.body) {
      h = docHeight;
    } else {
      // Started with http://james.padolsey.com/javascript/get-document-height-cross-browser/
      // to determine page height across browsers. Turns out that in our case, we can get by with
      // document.body.offsetHeight and document.body.clientHeight. Those two return the proper
      // height even when the dom shrinks. Tested on Chrome, Safari, IE8/9/10, and Firefox
      h = Math.max(container.offsetHeight, container.clientHeight);
      if (h === 0) {
        h = docHeight;
      }
    }
  }
  return { w: w, h: h };
};

module.exports = size;

},{"./document-container":7}]},{},[1])(1)
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvVXNlcnMvY3doaXR0aW5ndG9uL0RvY3VtZW50cy9zaW1wbGUteGRtL3NyYy9wbHVnaW4vaW5kZXguanMiLCIvVXNlcnMvY3doaXR0aW5ndG9uL0RvY3VtZW50cy9zaW1wbGUteGRtL3NyYy9jb21tb24vcG9zdG1lc3NhZ2UuanMiLCIvVXNlcnMvY3doaXR0aW5ndG9uL0RvY3VtZW50cy9zaW1wbGUteGRtL3NyYy9jb21tb24vdXRpbC5qcyIsIi9Vc2Vycy9jd2hpdHRpbmd0b24vRG9jdW1lbnRzL3NpbXBsZS14ZG0vc3JjL3BsdWdpbi9hcC5qcyIsIi9Vc2Vycy9jd2hpdHRpbmd0b24vRG9jdW1lbnRzL3NpbXBsZS14ZG0vc3JjL3BsdWdpbi9jb25maWd1cmF0aW9uLW9wdGlvbnMuanMiLCIvVXNlcnMvY3doaXR0aW5ndG9uL0RvY3VtZW50cy9zaW1wbGUteGRtL3NyYy9wbHVnaW4vY29uc3VtZXItb3B0aW9ucy5qcyIsIi9Vc2Vycy9jd2hpdHRpbmd0b24vRG9jdW1lbnRzL3NpbXBsZS14ZG0vc3JjL3BsdWdpbi9kb2N1bWVudC1jb250YWluZXIuanMiLCIvVXNlcnMvY3doaXR0aW5ndG9uL0RvY3VtZW50cy9zaW1wbGUteGRtL3NyYy9wbHVnaW4vZG9sbGFyLmpzIiwiL1VzZXJzL2N3aGl0dGluZ3Rvbi9Eb2N1bWVudHMvc2ltcGxlLXhkbS9zcmMvcGx1Z2luL3Jlc2l6ZS1saXN0ZW5lci5qcyIsIi9Vc2Vycy9jd2hpdHRpbmd0b24vRG9jdW1lbnRzL3NpbXBsZS14ZG0vc3JjL3BsdWdpbi9zaXplLmpzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBOzs7OztrQkNBZSxNQUFNOzs7O0FBQ3JCLE1BQU0sQ0FBQyxPQUFPLEdBQUcscUJBQVEsQ0FBQzs7Ozs7Ozs7Ozs7b0JDRFQsUUFBUTs7OztJQUNuQixXQUFXO0FBRUosV0FGUCxXQUFXLENBRUgsSUFBSSxFQUFFOzBCQUZk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LFFBQVEsQ0FBQyxlQUFlLENBQUMsWUFBWSxFQUM3RCxTQUFTLENBQUMsWUFBWSxFQUFFLFFBQVEsQ0FBQyxlQUFlLENBQUMsWUFBWSxFQUM3RCxTQUFTLENBQUMsWUFBWSxFQUFFLFFBQVEsQ0FBQyxlQUFlLENBQUMsWUFBWSxDQUM5RCxDQUFDOztBQUVGLFFBQUcsU0FBUyxLQUFLLFFBQVEsQ0FBQyxJQUFJLEVBQUM7QUFDN0IsT0FBQyxHQUFHLFNBQVMsQ0FBQztLQUNmLE1BQU07Ozs7O0FBS0wsT0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUMsU0FBUyxDQUFDLFlBQVksRUFBRSxTQUFTLENBQUMsWUFBWSxDQUFDLENBQUM7QUFDN0QsVUFBRyxDQUFDLEtBQUssQ0FBQyxFQUFDO0FBQ1QsU0FBQyxHQUFHLFNBQVMsQ0FBQztPQUNmO0tBQ0Y7R0FDRjtBQUNELFNBQU8sRUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLENBQUMsRUFBRSxDQUFDLEVBQUMsQ0FBQztDQUNyQixDQUFDOztBQUVGLE1BQU0sQ0FBQyxPQUFPLEdBQUcsSUFBSSxDQUFDIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsImltcG9ydCBBUCBmcm9tICcuL2FwJztcbm1vZHVsZS5leHBvcnRzID0gbmV3IEFQKCk7IiwiaW1wb3J0IFV0aWwgZnJvbSAnLi91dGlsJztcbmNsYXNzIFBvc3RNZXNzYWdlIHtcblxuICBjb25zdHJ1Y3RvcihkYXRhKSB7XG4gICAgbGV0IGQgPSBkYXRhIHx8IHt9O1xuICAgIHRoaXMuX3JlZ2lzdGVyTGlzdGVuZXIoZC5saXN0ZW5Pbik7XG4gIH1cblxuIC8vIGxpc3RlbiBmb3IgcG9zdE1lc3NhZ2UgZXZlbnRzIChkZWZhdWx0cyB0byB3aW5kb3cpLlxuICBfcmVnaXN0ZXJMaXN0ZW5lcihsaXN0ZW5Pbikge1xuICAgIGlmKCFsaXN0ZW5PbiB8fCAhbGlzdGVuT24uYWRkRXZlbnRMaXN0ZW5lcikge1xuICAgICAgbGlzdGVuT24gPSB3aW5kb3c7XG4gICAgfVxuICAgIGxpc3Rlbk9uLmFkZEV2ZW50TGlzdGVuZXIoXCJtZXNzYWdlXCIsIFV0aWwuX2JpbmQodGhpcywgdGhpcy5fcmVjZWl2ZU1lc3NhZ2UpLCBmYWxzZSk7XG4gIH1cblxuICBfcmVjZWl2ZU1lc3NhZ2UgKGV2ZW50KSB7XG4gICAgbGV0IGV4dGVuc2lvbklkID0gZXZlbnQuZGF0YS5laWQsXG4gICAgcmVnO1xuXG4gICAgaWYoZXh0ZW5zaW9uSWQgJiYgdGhpcy5fcmVnaXN0ZXJlZEV4dGVuc2lvbnMpe1xuICAgICAgcmVnID0gdGhpcy5fcmVnaXN0ZXJlZEV4dGVuc2lvbnNbZXh0ZW5zaW9uSWRdO1xuICAgIH1cblxuICAgIGlmICghdGhpcy5fY2hlY2tPcmlnaW4oZXZlbnQsIHJlZykpIHtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG5cbiAgICB2YXIgaGFuZGxlciA9IHRoaXMuX21lc3NhZ2VIYW5kbGVyc1tldmVudC5kYXRhLnR5cGVdO1xuICAgIGlmIChoYW5kbGVyKSB7XG4gICAgICBoYW5kbGVyLmNhbGwodGhpcywgZXZlbnQsIHJlZyk7XG4gICAgfVxuICB9XG5cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBQb3N0TWVzc2FnZTsiLCJjb25zdCBMT0dfUFJFRklYID0gXCJbU2ltcGxlLVhETV0gXCI7XG5cbmNsYXNzIFV0aWwge1xuXG4gIGxvY2F0aW9uT3JpZ2luKCkge1xuICAgIGlmICghd2luZG93LmxvY2F0aW9uLm9yaWdpbikge1xuICAgICAgcmV0dXJuIHdpbmRvdy5sb2NhdGlvbi5wcm90b2NvbCArIFwiLy9cIiArIHdpbmRvdy5sb2NhdGlvbi5ob3N0bmFtZSArICggd2luZG93LmxvY2F0aW9uLnBvcnQgPyAnOicgKyB3aW5kb3cubG9jYXRpb24ucG9ydCA6ICcnICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB3aW5kb3cubG9jYXRpb24ub3JpZ2luO1xuICAgIH1cbiAgfVxuXG4gIHJhbmRvbVN0cmluZygpIHtcbiAgICByZXR1cm4gTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMTAwMDAwMDAwMCkudG9TdHJpbmcoMTYpO1xuICB9XG5cbiAgaXNTdHJpbmcoc3RyKSB7XG4gICAgcmV0dXJuIHR5cGVvZiBzdHIgPT09IFwic3RyaW5nXCIgfHwgc3RyIGluc3RhbmNlb2YgU3RyaW5nO1xuICB9XG5cbiAgLy8gbWlnaHQgYmUgdW4tbmVlZGVkXG4gIGFyZ3VtZW50c1RvQXJyYXkoYXJyYXlMaWtlKSB7XG4gICAgdmFyIGFycmF5ID0gW107XG4gICAgZm9yICh2YXIgaSA9IDA7IGkgPCBhcnJheUxpa2UubGVuZ3RoOyBpKyspIHtcbiAgICAgIGFycmF5LnB1c2goYXJyYXlMaWtlW2ldKTtcbiAgICB9XG4gICAgcmV0dXJuIGFycmF5O1xuICB9XG5cbiAgaGFzQ2FsbGJhY2soYXJncykge1xuICAgIHZhciBsZW5ndGggPSBhcmdzLmxlbmd0aDtcbiAgICByZXR1cm4gbGVuZ3RoID4gMCAmJiB0eXBlb2YgYXJnc1tsZW5ndGggLSAxXSA9PT0gJ2Z1bmN0aW9uJztcbiAgfVxuXG4gIGVycm9yKG1zZykge1xuICAgICAgaWYgKHdpbmRvdy5jb25zb2xlKSB7XG4gICAgICAgICAgY29uc29sZS5lcnJvcihMT0dfUFJFRklYICsgbXNnKTtcbiAgICAgIH1cbiAgfVxuXG4gIHdhcm4obXNnKSB7XG4gICAgICBpZiAod2luZG93LmNvbnNvbGUpIHtcbiAgICAgICAgICBjb25zb2xlLndhcm4oTE9HX1BSRUZJWCArIG1zZyk7XG4gICAgICB9XG4gIH1cblxuICBfYmluZCh0aGlzcCwgZm4pe1xuICAgIGlmKEZ1bmN0aW9uLnByb3RvdHlwZS5iaW5kKSB7XG4gICAgICByZXR1cm4gZm4uYmluZCh0aGlzcCk7XG4gICAgfVxuICAgIHJldHVybiBmdW5jdGlvbiAoKSB7XG4gICAgICByZXR1cm4gZm4uYXBwbHkodGhpc3AsIGFyZ3VtZW50cyk7XG4gICAgfTtcbiAgfVxuXG4gIGVhY2gobywgaXQpIHtcbiAgICB2YXIgbDtcbiAgICB2YXIgaztcbiAgICBpZiAobykge1xuICAgICAgbCA9IG8ubGVuZ3RoO1xuICAgICAgaWYgKGwgIT0gbnVsbCAmJiB0eXBlb2YgbyAhPT0gJ2Z1bmN0aW9uJykge1xuICAgICAgICBrID0gMDtcbiAgICAgICAgd2hpbGUgKGsgPCBsKSB7XG4gICAgICAgICAgaWYgKGl0LmNhbGwob1trXSwgaywgb1trXSkgPT09IGZhbHNlKXtcbiAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgIH1cbiAgICAgICAgICBrICs9IDE7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGZvciAoayBpbiBvKSB7XG4gICAgICAgICAgaWYgKG8uaGFzT3duUHJvcGVydHkoaykpIHtcbiAgICAgICAgICAgIGlmIChpdC5jYWxsKG9ba10sIGssIG9ba10pID09PSBmYWxzZSl7XG4gICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGV4dGVuZChkZXN0KSB7XG4gICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG4gICAgdmFyIHNyY3MgPSBbXS5zbGljZS5jYWxsKGFyZ3MsIDEsIGFyZ3MubGVuZ3RoKTtcbiAgICBzcmNzLmZvckVhY2goZnVuY3Rpb24oc291cmNlKSB7XG4gICAgICBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhzb3VyY2UpLmZvckVhY2goZnVuY3Rpb24gKG5hbWUpIHtcbiAgICAgICAgZGVzdFtuYW1lXSA9IHNvdXJjZVtuYW1lXTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICAgIHJldHVybiBkZXN0O1xuICB9XG5cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgVXRpbCgpOyIsImltcG9ydCBVdGlsIGZyb20gJy4uL2NvbW1vbi91dGlsJztcbmltcG9ydCBQb3N0TWVzc2FnZSBmcm9tICcuLi9jb21tb24vcG9zdG1lc3NhZ2UnO1xuaW1wb3J0ICQgZnJvbSAnLi9kb2xsYXInO1xuaW1wb3J0IHNpemUgZnJvbSAnLi9zaXplJztcbmltcG9ydCByZXNpemVMaXN0ZW5lciBmcm9tICcuL3Jlc2l6ZS1saXN0ZW5lcic7XG5pbXBvcnQgQ29uZmlndXJhdGlvbk9wdGlvbnMgZnJvbSAnLi9jb25maWd1cmF0aW9uLW9wdGlvbnMnO1xuaW1wb3J0IENvbnN1bWVyT3B0aW9ucyBmcm9tICcuL2NvbnN1bWVyLW9wdGlvbnMnO1xuXG5jbGFzcyBBUCBleHRlbmRzIFBvc3RNZXNzYWdlIHtcblxuICBjb25zdHJ1Y3RvcihvcHRpb25zKSB7XG4gICAgc3VwZXIoKTtcbiAgICBDb25maWd1cmF0aW9uT3B0aW9ucy5zZXQob3B0aW9ucyk7XG4gICAgdGhpcy5fZGF0YSA9IHRoaXMuX3BhcnNlSW5pdERhdGEoKTtcbiAgICBDb25maWd1cmF0aW9uT3B0aW9ucy5zZXQodGhpcy5fZGF0YS5vcHRpb25zKTtcbiAgICB0aGlzLl9ob3N0ID0gd2luZG93LnBhcmVudDtcbiAgICB0aGlzLl9ob3N0TW9kdWxlcyA9IHt9O1xuICAgIHRoaXMuX2V2ZW50SGFuZGxlcnMgPSB7fTtcbiAgICB0aGlzLl9wZW5kaW5nQ2FsbGJhY2tzID0ge307XG4gICAgdGhpcy5fc2V0dXBBUEkodGhpcy5fZGF0YS5hcGkpO1xuICAgIHRoaXMuX3NldHVwQVBJV2l0aG91dFJlcXVpcmUodGhpcy5fZGF0YS5hcGkpO1xuICAgIHRoaXMuX21lc3NhZ2VIYW5kbGVycyA9IHtcbiAgICAgICAgcmVzcDogdGhpcy5faGFuZGxlUmVzcG9uc2UsXG4gICAgICAgIGV2dDogdGhpcy5faGFuZGxlRXZlbnRcbiAgICB9O1xuICAgICQoVXRpbC5fYmluZCh0aGlzLCB0aGlzLl9hdXRvUmVzaXplcikpO1xuICAgIHRoaXMuX3NlbmRJbml0KCk7XG4gIH1cblxuICBfYXV0b1Jlc2l6ZXIoKSB7XG4gICAgdGhpcy5fZW5hYmxlQXV0b1Jlc2l6ZSA9IEJvb2xlYW4oQ29uZmlndXJhdGlvbk9wdGlvbnMuZ2V0KCdhdXRvcmVzaXplJykpO1xuICAgIGlmKENvbnN1bWVyT3B0aW9ucy5nZXQoJ3Jlc2l6ZScpID09PSBmYWxzZSkge1xuICAgICAgdGhpcy5fZW5hYmxlQXV0b1Jlc2l6ZSA9IGZhbHNlO1xuICAgIH1cbiAgICBpZih0aGlzLl9lbmFibGVBdXRvUmVzaXplKSB7XG4gICAgICB0aGlzLl9pbml0UmVzaXplKCk7XG4gICAgfVxuICB9XG5cbiAgLyoqXG4gICogVGhlIGluaXRpYWxpemF0aW9uIGRhdGEgaXMgcGFzc2VkIGluIHdoZW4gdGhlIGlmcmFtZSBpcyBjcmVhdGVkIGFzIGl0cyAnbmFtZScgYXR0cmlidXRlLlxuICAqIEV4YW1wbGU6XG4gICoge1xuICAqICAgZXh0ZW5zaW9uX2lkOiBUaGUgSUQgb2YgdGhpcyBpZnJhbWUgYXMgZGVmaW5lZCBieSB0aGUgaG9zdFxuICAqICAgb3JpZ2luOiAnaHR0cHM6Ly9leGFtcGxlLm9yZycgIC8vIFRoZSBwYXJlbnQncyB3aW5kb3cgb3JpZ2luXG4gICogICBhcGk6IHtcbiAgKiAgICAgX2dsb2JhbHM6IHsgLi4uIH0sXG4gICogICAgIG1lc3NhZ2VzID0ge1xuICAqICAgICAgIGNsZWFyOiB7fSxcbiAgKiAgICAgICAuLi5cbiAgKiAgICAgfSxcbiAgKiAgICAgLi4uXG4gICogICB9XG4gICogfVxuICAqKi9cbiAgX3BhcnNlSW5pdERhdGEoZGF0YSkge1xuICAgIHRyeSB7XG4gICAgICByZXR1cm4gSlNPTi5wYXJzZShkYXRhIHx8IHdpbmRvdy5uYW1lKTtcbiAgICB9IGNhdGNoIChlKSB7XG4gICAgICByZXR1cm4ge307XG4gICAgfVxuICB9XG5cbiAgX2NyZWF0ZU1vZHVsZShtb2R1bGVOYW1lLCBhcGkpIHtcbiAgICByZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoYXBpKS5yZWR1Y2UoKGFjY3VtdWxhdG9yLCBmdW5jdGlvbk5hbWUpID0+IHtcbiAgICAgIGFjY3VtdWxhdG9yW2Z1bmN0aW9uTmFtZV0gPSB0aGlzLl9jcmVhdGVNZXRob2RIYW5kbGVyKHtcbiAgICAgICAgICBtb2Q6IG1vZHVsZU5hbWUsXG4gICAgICAgICAgZm46IGZ1bmN0aW9uTmFtZVxuICAgICAgfSk7XG4gICAgICByZXR1cm4gYWNjdW11bGF0b3I7XG4gICAgfSwge30pO1xuICB9XG5cbiAgX3NldHVwQVBJKGFwaSkge1xuICAgIHRoaXMuX2hvc3RNb2R1bGVzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoYXBpKS5yZWR1Y2UoKGFjY3VtdWxhdG9yLCBtb2R1bGVOYW1lKSA9PiB7XG4gICAgICAgIGFjY3VtdWxhdG9yW21vZHVsZU5hbWVdID0gdGhpcy5fY3JlYXRlTW9kdWxlKG1vZHVsZU5hbWUsIGFwaVttb2R1bGVOYW1lXSk7XG4gICAgICAgIHJldHVybiBhY2N1bXVsYXRvcjtcbiAgICB9LCB7fSk7XG5cbiAgICBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyh0aGlzLl9ob3N0TW9kdWxlcy5fZ2xvYmFscyB8fCB7fSkuZm9yRWFjaCgoZ2xvYmFsKSA9PiB7XG4gICAgICAgIHRoaXNbZ2xvYmFsXSA9IHRoaXMuX2hvc3RNb2R1bGVzLl9nbG9iYWxzW2dsb2JhbF07XG4gICAgfSk7XG4gIH1cblxuICBfc2V0dXBBUElXaXRob3V0UmVxdWlyZShhcGkpIHtcbiAgICBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhhcGkpLmZvckVhY2goKG1vZHVsZU5hbWUpID0+IHtcbiAgICAgIGlmKHR5cGVvZiB0aGlzW21vZHVsZU5hbWVdICE9PSBcInVuZGVmaW5lZFwiKSB7XG4gICAgICAgIHRocm93IG5ldyBFcnJvcignWERNIG1vZHVsZTogJyArIG1vZHVsZU5hbWUgKyAnIHdpbGwgY29sbGlkZSB3aXRoIGV4aXN0aW5nIHZhcmlhYmxlJyk7XG4gICAgICB9XG4gICAgICB0aGlzW21vZHVsZU5hbWVdID0gdGhpcy5fY3JlYXRlTW9kdWxlKG1vZHVsZU5hbWUsIGFwaVttb2R1bGVOYW1lXSk7XG4gICAgfSwgdGhpcyk7XG4gIH1cblxuICBfcGVuZGluZ0NhbGxiYWNrKG1pZCwgZm4pe1xuICAgIHRoaXMuX3BlbmRpbmdDYWxsYmFja3NbbWlkXSA9IGZuO1xuICB9XG5cbiAgX2NyZWF0ZU1ldGhvZEhhbmRsZXIobWV0aG9kRGF0YSkge1xuICAgIGxldCBtZXRob2RIYW5kbGVyID0gZnVuY3Rpb24gKCkge1xuICAgICAgbGV0IG1pZCxcbiAgICAgICAgICBhcmdzID0gVXRpbC5hcmd1bWVudHNUb0FycmF5KGFyZ3VtZW50cyk7XG4gICAgICBpZiAoVXRpbC5oYXNDYWxsYmFjayhhcmdzKSkge1xuICAgICAgICBtaWQgPSBVdGlsLnJhbmRvbVN0cmluZygpO1xuICAgICAgICB0aGlzLl9wZW5kaW5nQ2FsbGJhY2sobWlkLCBhcmdzLnBvcCgpKTtcbiAgICAgIH1cbiAgICAgIHRoaXMuX2hvc3QucG9zdE1lc3NhZ2Uoe1xuICAgICAgICAgIGVpZDogdGhpcy5fZGF0YS5leHRlbnNpb25faWQsXG4gICAgICAgICAgdHlwZTogJ3JlcScsXG4gICAgICAgICAgbWlkOiBtaWQsXG4gICAgICAgICAgbW9kOiBtZXRob2REYXRhLm1vZCxcbiAgICAgICAgICBmbjogbWV0aG9kRGF0YS5mbixcbiAgICAgICAgICBhcmdzOiBhcmdzXG4gICAgICB9LCB0aGlzLl9kYXRhLm9yaWdpbik7XG4gICAgfTtcblxuICAgIHJldHVybiBVdGlsLl9iaW5kKHRoaXMsIG1ldGhvZEhhbmRsZXIpO1xuICB9XG5cbiAgX2hhbmRsZVJlc3BvbnNlKGV2ZW50KSB7XG4gICAgdmFyIGRhdGEgPSBldmVudC5kYXRhO1xuICAgIHZhciBwZW5kaW5nQ2FsbGJhY2sgPSB0aGlzLl9wZW5kaW5nQ2FsbGJhY2tzW2RhdGEubWlkXTtcbiAgICBpZiAocGVuZGluZ0NhbGxiYWNrKSB7XG4gICAgICBkZWxldGUgdGhpcy5fcGVuZGluZ0NhbGxiYWNrc1tkYXRhLm1pZF07XG4gICAgICBwZW5kaW5nQ2FsbGJhY2suYXBwbHkod2luZG93LCBkYXRhLmFyZ3MpO1xuICAgIH1cbiAgfVxuXG4gIF9oYW5kbGVFdmVudChldmVudCkge1xuICAgIHZhciBzZW5kUmVzcG9uc2UgPSBmdW5jdGlvbiAoKSB7XG4gICAgICB2YXIgYXJncyA9IFV0aWwuYXJndW1lbnRzVG9BcnJheShhcmd1bWVudHMpO1xuICAgICAgZXZlbnQuc291cmNlLnBvc3RNZXNzYWdlKHtcbiAgICAgICAgICBlaWQ6IHRoaXMuX2RhdGEuZXh0ZW5zaW9uX2lkLFxuICAgICAgICAgIG1pZDogZXZlbnQuZGF0YS5taWQsXG4gICAgICAgICAgdHlwZTogJ3Jlc3AnLFxuICAgICAgICAgIGFyZ3M6IGFyZ3NcbiAgICAgIH0sIHRoaXMuX2RhdGEub3JpZ2luKTtcbiAgICB9O1xuICAgIHNlbmRSZXNwb25zZSA9IFV0aWwuX2JpbmQodGhpcywgc2VuZFJlc3BvbnNlKTtcbiAgICB2YXIgZGF0YSA9IGV2ZW50LmRhdGE7XG4gICAgdmFyIGhhbmRsZXIgPSB0aGlzLl9ldmVudEhhbmRsZXJzW2RhdGEuZXR5cF07XG4gICAgaWYgKGhhbmRsZXIpIHtcbiAgICAgICAgaGFuZGxlcihkYXRhLmV2bnQsIHNlbmRSZXNwb25zZSk7XG4gICAgfSBlbHNlIGlmIChkYXRhLm1pZCkge1xuICAgICAgICBzZW5kUmVzcG9uc2UoKTtcbiAgICB9XG4gIH1cblxuICBfY2hlY2tPcmlnaW4oZXZlbnQpIHtcbiAgICAgIHJldHVybiBldmVudC5vcmlnaW4gPT09IHRoaXMuX2RhdGEub3JpZ2luICYmIGV2ZW50LnNvdXJjZSA9PT0gdGhpcy5faG9zdDtcbiAgfVxuXG4gIF9zZW5kSW5pdCgpIHtcbiAgICB0aGlzLl9ob3N0LnBvc3RNZXNzYWdlKHtcbiAgICAgICAgZWlkOiB0aGlzLl9kYXRhLmV4dGVuc2lvbl9pZCxcbiAgICAgICAgdHlwZTogJ2luaXQnXG4gICAgfSwgdGhpcy5fZGF0YS5vcmlnaW4pO1xuICB9XG5cbiAgYnJvYWRjYXN0KGV2ZW50LCBldm50KSB7XG4gICAgaWYgKCFVdGlsLmlzU3RyaW5nKGV2ZW50KSkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRXZlbnQgdHlwZSBtdXN0IGJlIHN0cmluZ1wiKTtcbiAgICB9XG5cbiAgICB0aGlzLl9ob3N0LnBvc3RNZXNzYWdlKHtcbiAgICAgIGVpZDogdGhpcy5fZGF0YS5leHRlbnNpb25faWQsXG4gICAgICB0eXBlOiAnYnJvYWRjYXN0JyxcbiAgICAgIGV0eXA6IGV2ZW50LFxuICAgICAgZXZudDogZXZudFxuICAgIH0sIHRoaXMuX2RhdGEub3JpZ2luKTtcbiAgfVxuXG4gIHJlcXVpcmUobW9kdWxlcywgY2FsbGJhY2spIHtcbiAgICBsZXQgcmVxdWlyZWRNb2R1bGVzID0gQXJyYXkuaXNBcnJheShtb2R1bGVzKSA/IG1vZHVsZXMgOiBbbW9kdWxlc10sXG4gICAgICAgIGFyZ3MgPSByZXF1aXJlZE1vZHVsZXMubWFwKChtb2R1bGUpID0+IHtcbiAgICAgICAgICByZXR1cm4gdGhpcy5faG9zdE1vZHVsZXNbbW9kdWxlXTtcbiAgICAgICAgfSk7XG4gICAgY2FsbGJhY2suYXBwbHkod2luZG93LCBhcmdzKTtcbiAgfVxuXG4gIHJlZ2lzdGVyKGhhbmRsZXJzKSB7XG4gICAgdGhpcy5fZXZlbnRIYW5kbGVycyA9IGhhbmRsZXJzIHx8IHt9O1xuICAgIHRoaXMuX2hvc3QucG9zdE1lc3NhZ2Uoe1xuICAgICAgZWlkOiB0aGlzLl9kYXRhLmV4dGVuc2lvbl9pZCxcbiAgICAgIHR5cGU6ICdldmVudF9xdWVyeScsXG4gICAgICBhcmdzOiBPYmplY3QuZ2V0T3duUHJvcGVydHlOYW1lcyhoYW5kbGVycylcbiAgICB9LCB0aGlzLl9kYXRhLm9yaWdpbik7XG4gIH1cblxuICBfaW5pdFJlc2l6ZSgpIHtcbiAgICB2YXIgcmVzaXplID0gVXRpbC5fYmluZCh0aGlzLCBmdW5jdGlvbigpe1xuICAgICAgdmFyIGRpbWVuc2lvbnMgPSBzaXplKCk7XG4gICAgICB0aGlzLnJlcXVpcmUoJ2VudicsIChlbnYpID0+IHtcbiAgICAgICAgaWYgKGVudiAmJiBlbnYucmVzaXplKSB7XG4gICAgICAgICAgZW52LnJlc2l6ZShkaW1lbnNpb25zLncsIGRpbWVuc2lvbnMuaCk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcmVzaXplKCk7XG4gICAgcmVzaXplTGlzdGVuZXIuYWRkKHJlc2l6ZSk7XG4gIH1cblxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEFQOyIsIi8qKlxuKiBFeHRlbnNpb24gd2lkZSBjb25maWd1cmF0aW9uIHZhbHVlc1xuKi9cbmNsYXNzIENvbmZpZ3VyYXRpb25PcHRpb25zIHtcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICB0aGlzLm9wdGlvbnMgPSB7fTtcbiAgfVxuXG4gIF9mbHVzaCgpIHtcbiAgICB0aGlzLm9wdGlvbnMgPSB7fTtcbiAgfVxuXG4gIGdldChpdGVtKSB7XG4gICAgcmV0dXJuIChpdGVtKSA/IHRoaXMub3B0aW9uc1tpdGVtXSA6IHRoaXMub3B0aW9ucztcbiAgfVxuXG4gIHNldChkYXRhLCB2YWx1ZSkge1xuICAgIGlmKCFkYXRhKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYodmFsdWUpIHtcbiAgICAgIGRhdGEgPSB7W2RhdGFdOiB2YWx1ZX07XG4gICAgfVxuICAgIHZhciBrZXlzID0gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoZGF0YSk7XG4gICAga2V5cy5mb3JFYWNoKChrZXkpID0+IHtcbiAgICAgIHRoaXMub3B0aW9uc1trZXldID0gZGF0YVtrZXldO1xuICAgIH0sIHRoaXMpO1xuICB9XG5cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBuZXcgQ29uZmlndXJhdGlvbk9wdGlvbnMoKTsiLCJpbXBvcnQgJCBmcm9tICcuL2RvbGxhcic7XG5cbmNsYXNzIENvbnN1bWVyT3B0aW9ucyB7XG5cbiAgX2dldENvbnN1bWVyT3B0aW9ucygpIHtcbiAgICB2YXIgb3B0aW9ucyA9IHt9LFxuICAgICAgJHNjcmlwdCA9ICQoXCJzY3JpcHRbc3JjKj0nL2F0bGFzc2lhbi1jb25uZWN0L2FsbCddXCIpO1xuXG4gICAgaWYgKCAhKCRzY3JpcHQgJiYgL1xcL2F0bGFzc2lhbi1jb25uZWN0XFwvYWxsKC1kZWJ1Zyk/XFwuanMoJHxcXD8pLy50ZXN0KCRzY3JpcHQuYXR0cihcInNyY1wiKSkpICl7XG4gICAgICAkc2NyaXB0ID0gJChcIiNhYy1pZnJhbWUtb3B0aW9uc1wiKTtcbiAgICB9XG5cbiAgICBpZigkc2NyaXB0ICYmICRzY3JpcHQubGVuZ3RoID4gMCkge1xuICAgICAgLy8gZ2V0IGl0cyBkYXRhLW9wdGlvbnMgYXR0cmlidXRlLCBpZiBhbnlcbiAgICAgIHZhciBvcHRTdHIgPSAkc2NyaXB0LmF0dHIoXCJkYXRhLW9wdGlvbnNcIik7XG4gICAgICBpZiAob3B0U3RyKSB7XG4gICAgICAgIC8vIGlmIGZvdW5kLCBwYXJzZSB0aGUgdmFsdWUgaW50byBrdiBwYWlycyBmb2xsb3dpbmcgdGhlIGZvcm1hdCBvZiBhIHN0eWxlIGVsZW1lbnRcbiAgICAgICAgb3B0U3RyLnNwbGl0KFwiO1wiKS5mb3JFYWNoKChudnBhaXIpID0+IHtcbiAgICAgICAgICBudnBhaXIgPSBudnBhaXIudHJpbSgpO1xuICAgICAgICAgIGlmIChudnBhaXIpIHtcbiAgICAgICAgICAgIHZhciBudiA9IG52cGFpci5zcGxpdChcIjpcIiksIGsgPSBudlswXS50cmltKCksIHYgPSBudlsxXS50cmltKCk7XG4gICAgICAgICAgICBpZiAoayAmJiB2ICE9IG51bGwpIHtcbiAgICAgICAgICAgICAgb3B0aW9uc1trXSA9IHYgPT09IFwidHJ1ZVwiIHx8IHYgPT09IFwiZmFsc2VcIiA/IHYgPT09IFwidHJ1ZVwiIDogdjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH1cblxuICAgIHJldHVybiBvcHRpb25zO1xuICB9XG5cbiAgX2ZsdXNoKCkge1xuICAgIGRlbGV0ZSB0aGlzLl9vcHRpb25zO1xuICB9XG5cbiAgZ2V0KGtleSkge1xuICAgIGlmKCF0aGlzLl9vcHRpb25zKSB7XG4gICAgICB0aGlzLl9vcHRpb25zID0gdGhpcy5fZ2V0Q29uc3VtZXJPcHRpb25zKCk7XG4gICAgfVxuICAgIGlmKGtleSkge1xuICAgICAgcmV0dXJuIHRoaXMuX29wdGlvbnNba2V5XTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX29wdGlvbnM7XG4gIH1cblxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IG5ldyBDb25zdW1lck9wdGlvbnMoKTsiLCJpbXBvcnQgJCBmcm9tICcuL2RvbGxhcic7XG5cbmZ1bmN0aW9uIGdldENvbnRhaW5lcigpe1xuICAvLyBMb29rIGZvciB0aGVzZSB0d28gc2VsZWN0b3JzIGZpcnN0Li4uIHlvdSBuZWVkIHRoZXNlIHRvIGFsbG93IGZvciB0aGUgYXV0by1zaHJpbmsgdG8gd29ya1xuICAvLyBPdGhlcndpc2UsIGl0J2xsIGRlZmF1bHQgdG8gZG9jdW1lbnQuYm9keSB3aGljaCBjYW4ndCBhdXRvLWdyb3cgb3IgYXV0by1zaHJpbmtcbiAgdmFyIGNvbnRhaW5lciA9ICQoJy5hYy1jb250ZW50LCAjY29udGVudCcpO1xuICByZXR1cm4gKGNvbnRhaW5lci5sZW5ndGggPiAwKSA/IGNvbnRhaW5lclswXSA6IGRvY3VtZW50LmJvZHk7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gZ2V0Q29udGFpbmVyOyIsImltcG9ydCBVdGlsIGZyb20gJy4uL2NvbW1vbi91dGlsJztcblxudmFyIGVhY2ggPSBVdGlsLmVhY2gsXG4gICAgZG9jdW1lbnQgPSB3aW5kb3cuZG9jdW1lbnQ7XG5cbmZ1bmN0aW9uICQoc2VsLCBjb250ZXh0KSB7XG5cbiAgY29udGV4dCA9IGNvbnRleHQgfHwgZG9jdW1lbnQ7XG5cbiAgdmFyIGVscyA9IFtdO1xuICBpZiAoc2VsKSB7XG4gICAgaWYgKHR5cGVvZiBzZWwgPT09ICdzdHJpbmcnKSB7XG4gICAgICB2YXIgcmVzdWx0cyA9IGNvbnRleHQucXVlcnlTZWxlY3RvckFsbChzZWwpLFxuICAgICAgICBhcnJfcmVzdWx0cyA9IEFycmF5LnByb3RvdHlwZS5zbGljZS5jYWxsKHJlc3VsdHMpO1xuICAgICAgQXJyYXkucHJvdG90eXBlLnB1c2guYXBwbHkoZWxzLCBhcnJfcmVzdWx0cyk7XG4gICAgfVxuICAgIGVsc2UgaWYgKHNlbC5ub2RlVHlwZSA9PT0gMSkge1xuICAgICAgZWxzLnB1c2goc2VsKTtcbiAgICB9XG4gICAgZWxzZSBpZiAoc2VsID09PSB3aW5kb3cpIHtcbiAgICAgIGVscy5wdXNoKHNlbCk7XG4gICAgfSBlbHNlIGlmICh0eXBlb2Ygc2VsID09PSAnZnVuY3Rpb24nKSB7XG4gICAgICBvbkRvbUxvYWQoc2VsKTtcbiAgICB9XG4gIH1cblxuICBVdGlsLmV4dGVuZChlbHMsIHtcbiAgICBlYWNoOiBmdW5jdGlvbiAoaXQpIHtcbiAgICAgIGVhY2godGhpcywgaXQpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfSxcbiAgICBiaW5kOiBmdW5jdGlvbiAobmFtZSwgY2FsbGJhY2spIHtcbiAgICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgICAgdGhpcy5iaW5kKGVsLCBuYW1lLCBjYWxsYmFjayk7XG4gICAgICB9KTtcbiAgICB9LFxuICAgIGF0dHI6IGZ1bmN0aW9uIChrKSB7XG4gICAgICB2YXIgdjtcbiAgICAgIHRoaXMuZWFjaChmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgICAgdiA9IGVsW2tdIHx8IChlbC5nZXRBdHRyaWJ1dGUgJiYgZWwuZ2V0QXR0cmlidXRlKGspKTtcbiAgICAgICAgcmV0dXJuICF2O1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gdjtcbiAgICB9LFxuICAgIHJlbW92ZUNsYXNzOiBmdW5jdGlvbiAoY2xhc3NOYW1lKSB7XG4gICAgICByZXR1cm4gdGhpcy5lYWNoKGZ1bmN0aW9uIChpLCBlbCkge1xuICAgICAgICBpZiAoZWwuY2xhc3NOYW1lKSB7XG4gICAgICAgICAgZWwuY2xhc3NOYW1lID0gZWwuY2xhc3NOYW1lLnJlcGxhY2UobmV3IFJlZ0V4cCgnKF58XFxcXHMpJyArIGNsYXNzTmFtZSArICcoXFxcXHN8JCknKSwgJyAnKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSxcbiAgICBodG1sOiBmdW5jdGlvbiAoaHRtbCkge1xuICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoaSwgZWwpIHtcbiAgICAgICAgZWwuaW5uZXJIVE1MID0gaHRtbDtcbiAgICAgIH0pO1xuICAgIH0sXG4gICAgYXBwZW5kOiBmdW5jdGlvbiAoc3BlYykge1xuICAgICAgcmV0dXJuIHRoaXMuZWFjaChmdW5jdGlvbiAoaSwgdG8pIHtcbiAgICAgICAgdmFyIGVsID0gY29udGV4dC5jcmVhdGVFbGVtZW50KHNwZWMudGFnKTtcbiAgICAgICAgZWFjaChzcGVjLCBmdW5jdGlvbiAoaywgdikge1xuICAgICAgICAgIGlmIChrID09PSAnJHRleHQnKSB7XG4gICAgICAgICAgICBpZiAoZWwuc3R5bGVTaGVldCkgeyAvLyBzdHlsZSB0YWdzIGluIGllXG4gICAgICAgICAgICAgIGVsLnN0eWxlU2hlZXQuY3NzVGV4dCA9IHY7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgZWwuYXBwZW5kQ2hpbGQoY29udGV4dC5jcmVhdGVUZXh0Tm9kZSh2KSk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfVxuICAgICAgICAgIGVsc2UgaWYgKGsgIT09ICd0YWcnKSB7XG4gICAgICAgICAgICBlbFtrXSA9IHY7XG4gICAgICAgICAgfVxuICAgICAgICB9KTtcbiAgICAgICAgdG8uYXBwZW5kQ2hpbGQoZWwpO1xuICAgICAgfSk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gZWxzO1xufVxuXG5mdW5jdGlvbiBiaW5kZXIoc3RkLCBvZGQpIHtcbiAgc3RkICs9ICdFdmVudExpc3RlbmVyJztcbiAgb2RkICs9ICdFdmVudCc7XG4gIHJldHVybiBmdW5jdGlvbiAoZWwsIGUsIGZuKSB7XG4gICAgaWYgKGVsW3N0ZF0pIHtcbiAgICAgIGVsW3N0ZF0oZSwgZm4sIGZhbHNlKTtcbiAgICB9IGVsc2UgaWYgKGVsW29kZF0pIHtcbiAgICAgIGVsW29kZF0oJ29uJyArIGUsIGZuKTtcbiAgICB9XG4gIH07XG59XG5cbiQuYmluZCA9IGJpbmRlcignYWRkJywgJ2F0dGFjaCcpO1xuJC51bmJpbmQgPSBiaW5kZXIoJ3JlbW92ZScsICdkZXRhY2gnKTtcblxuZnVuY3Rpb24gb25Eb21Mb2FkKGZ1bmMpIHtcbiAgdmFyIHcgPSB3aW5kb3csXG4gICAgcmVhZHlTdGF0ZSA9IHcuZG9jdW1lbnQucmVhZHlTdGF0ZTtcblxuICBpZiAocmVhZHlTdGF0ZSA9PT0gXCJpbnRlcmFjdGl2ZVwiIHx8IHJlYWR5U3RhdGUgPT09IFwiY29tcGxldGVcIikge1xuICAgIGZ1bmMuY2FsbCh3KTtcbiAgfSBlbHNlIHtcbiAgICAkLmJpbmQodywgXCJsb2FkXCIsIGZ1bmN0aW9uKCl7XG4gICAgICBmdW5jLmNhbGwodyk7XG4gICAgfSk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgJDtcbiIsImltcG9ydCBkb2N1bWVudENvbnRhaW5lciBmcm9tICcuL2RvY3VtZW50LWNvbnRhaW5lcic7XG5cbmZ1bmN0aW9uIEV2ZW50UXVldWUoKSB7XG4gICAgdGhpcy5xID0gW107XG4gICAgdGhpcy5hZGQgPSBmdW5jdGlvbihldikge1xuICAgICAgICB0aGlzLnEucHVzaChldik7XG4gICAgfTtcblxuICAgIHZhciBpLCBqO1xuICAgIHRoaXMuY2FsbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBmb3IgKGkgPSAwLCBqID0gdGhpcy5xLmxlbmd0aDsgaSA8IGo7IGkrKykge1xuICAgICAgICAgICAgdGhpcy5xW2ldLmNhbGwoKTtcbiAgICAgICAgfVxuICAgIH07XG59XG5cbmZ1bmN0aW9uIGF0dGFjaFJlc2l6ZUV2ZW50KGVsZW1lbnQsIHJlc2l6ZWQpIHtcbiAgICBpZiAoIWVsZW1lbnQucmVzaXplZEF0dGFjaGVkKSB7XG4gICAgICAgIGVsZW1lbnQucmVzaXplZEF0dGFjaGVkID0gbmV3IEV2ZW50UXVldWUoKTtcbiAgICAgICAgZWxlbWVudC5yZXNpemVkQXR0YWNoZWQuYWRkKHJlc2l6ZWQpO1xuICAgIH0gZWxzZSBpZiAoZWxlbWVudC5yZXNpemVkQXR0YWNoZWQpIHtcbiAgICAgICAgZWxlbWVudC5yZXNpemVkQXR0YWNoZWQuYWRkKHJlc2l6ZWQpO1xuICAgICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgZWxlbWVudC5yZXNpemVTZW5zb3IgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICBlbGVtZW50LnJlc2l6ZVNlbnNvci5jbGFzc05hbWUgPSAnYWMtcmVzaXplLXNlbnNvcic7XG4gICAgdmFyIHN0eWxlID0gJ3Bvc2l0aW9uOiBhYnNvbHV0ZTsgbGVmdDogMDsgdG9wOiAwOyByaWdodDogMDsgYm90dG9tOiAwOyBvdmVyZmxvdzogc2Nyb2xsOyB6LWluZGV4OiAtMTsgdmlzaWJpbGl0eTogaGlkZGVuOyc7XG4gICAgdmFyIHN0eWxlQ2hpbGQgPSAncG9zaXRpb246IGFic29sdXRlOyBsZWZ0OiAwOyB0b3A6IDA7JztcblxuICAgIGVsZW1lbnQucmVzaXplU2Vuc29yLnN0eWxlLmNzc1RleHQgPSBzdHlsZTtcbiAgICBlbGVtZW50LnJlc2l6ZVNlbnNvci5pbm5lckhUTUwgPVxuICAgICAgICAnPGRpdiBjbGFzcz1cImFjLXJlc2l6ZS1zZW5zb3ItZXhwYW5kXCIgc3R5bGU9XCInICsgc3R5bGUgKyAnXCI+JyArXG4gICAgICAgICAgICAnPGRpdiBzdHlsZT1cIicgKyBzdHlsZUNoaWxkICsgJ1wiPjwvZGl2PicgK1xuICAgICAgICAnPC9kaXY+JyArXG4gICAgICAgICc8ZGl2IGNsYXNzPVwiYWMtcmVzaXplLXNlbnNvci1zaHJpbmtcIiBzdHlsZT1cIicgKyBzdHlsZSArICdcIj4nICtcbiAgICAgICAgICAgICc8ZGl2IHN0eWxlPVwiJyArIHN0eWxlQ2hpbGQgKyAnIHdpZHRoOiAyMDAlOyBoZWlnaHQ6IDIwMCVcIj48L2Rpdj4nICtcbiAgICAgICAgJzwvZGl2Pic7XG4gICAgZWxlbWVudC5hcHBlbmRDaGlsZChlbGVtZW50LnJlc2l6ZVNlbnNvcik7XG5cbiAgICBpZiAoZ2V0Q29tcHV0ZWRTdHlsZShlbGVtZW50KS5wb3NpdGlvbiA9PT0gJ3N0YXRpYycpe1xuICAgICAgICBlbGVtZW50LnN0eWxlLnBvc2l0aW9uID0gJ3JlbGF0aXZlJztcbiAgICB9XG5cbiAgICB2YXIgZXhwYW5kID0gZWxlbWVudC5yZXNpemVTZW5zb3IuY2hpbGROb2Rlc1swXTtcbiAgICB2YXIgZXhwYW5kQ2hpbGQgPSBleHBhbmQuY2hpbGROb2Rlc1swXTtcbiAgICB2YXIgc2hyaW5rID0gZWxlbWVudC5yZXNpemVTZW5zb3IuY2hpbGROb2Rlc1sxXTtcblxuICAgIHZhciBsYXN0V2lkdGgsIGxhc3RIZWlnaHQ7XG5cbiAgICB2YXIgcmVzZXQgPSBmdW5jdGlvbigpIHtcbiAgICAgICAgZXhwYW5kQ2hpbGQuc3R5bGUud2lkdGggPSBleHBhbmQub2Zmc2V0V2lkdGggKyAxMCArICdweCc7XG4gICAgICAgIGV4cGFuZENoaWxkLnN0eWxlLmhlaWdodCA9IGV4cGFuZC5vZmZzZXRIZWlnaHQgKyAxMCArICdweCc7XG4gICAgICAgIGV4cGFuZC5zY3JvbGxMZWZ0ID0gZXhwYW5kLnNjcm9sbFdpZHRoO1xuICAgICAgICBleHBhbmQuc2Nyb2xsVG9wID0gZXhwYW5kLnNjcm9sbEhlaWdodDtcbiAgICAgICAgc2hyaW5rLnNjcm9sbExlZnQgPSBzaHJpbmsuc2Nyb2xsV2lkdGg7XG4gICAgICAgIHNocmluay5zY3JvbGxUb3AgPSBzaHJpbmsuc2Nyb2xsSGVpZ2h0O1xuICAgICAgICBsYXN0V2lkdGggPSBlbGVtZW50Lm9mZnNldFdpZHRoO1xuICAgICAgICBsYXN0SGVpZ2h0ID0gZWxlbWVudC5vZmZzZXRIZWlnaHQ7XG4gICAgfTtcblxuICAgIHJlc2V0KCk7XG5cbiAgICB2YXIgY2hhbmdlZCA9IGZ1bmN0aW9uKCkge1xuICAgICAgICBpZiAoZWxlbWVudC5yZXNpemVkQXR0YWNoZWQpIHtcbiAgICAgICAgICAgIGVsZW1lbnQucmVzaXplZEF0dGFjaGVkLmNhbGwoKTtcbiAgICAgICAgfVxuICAgIH07XG5cbiAgICB2YXIgb25TY3JvbGwgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmIChlbGVtZW50Lm9mZnNldFdpZHRoICE9PSBsYXN0V2lkdGggfHwgZWxlbWVudC5vZmZzZXRIZWlnaHQgIT09IGxhc3RIZWlnaHQpIHtcbiAgICAgICAgICBjaGFuZ2VkKCk7XG4gICAgICB9XG4gICAgICByZXNldCgpO1xuICAgIH07XG5cbiAgICBleHBhbmQuYWRkRXZlbnRMaXN0ZW5lcignc2Nyb2xsJywgb25TY3JvbGwpO1xuICAgIHNocmluay5hZGRFdmVudExpc3RlbmVyKCdzY3JvbGwnLCBvblNjcm9sbCk7XG5cbn1cblxubW9kdWxlLmV4cG9ydHMgPSB7XG4gIGFkZDogZnVuY3Rpb24oZm4pe1xuICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudENvbnRhaW5lcigpO1xuICAgIGF0dGFjaFJlc2l6ZUV2ZW50KGNvbnRhaW5lciwgZm4pO1xuICB9LFxuICByZW1vdmU6IGZ1bmN0aW9uKCl7XG4gICAgdmFyIGNvbnRhaW5lciA9IGRvY3VtZW50Q29udGFpbmVyKCk7XG4gICAgaWYgKGNvbnRhaW5lci5yZXNpemVTZW5zb3IpIHtcbiAgICAgIGNvbnRhaW5lci5yZW1vdmVDaGlsZChjb250YWluZXIucmVzaXplU2Vuc29yKTtcbiAgICAgIGRlbGV0ZSBjb250YWluZXIucmVzaXplU2Vuc29yO1xuICAgICAgZGVsZXRlIGNvbnRhaW5lci5yZXNpemVkQXR0YWNoZWQ7XG4gICAgfVxuICB9XG59O1xuIiwiaW1wb3J0IGRvY3VtZW50Q29udGFpbmVyIGZyb20gJy4vZG9jdW1lbnQtY29udGFpbmVyJztcblxudmFyIHNpemUgPSBmdW5jdGlvbiAod2lkdGgsIGhlaWdodCwgY29udGFpbmVyKSB7XG4gIHZhciB3ID0gd2lkdGggPT0gbnVsbCA/ICcxMDAlJyA6IHdpZHRoLCBoLCBkb2NIZWlnaHQ7XG5cbiAgaWYoIWNvbnRhaW5lcil7XG4gICAgY29udGFpbmVyID0gZG9jdW1lbnRDb250YWluZXIoKTtcbiAgfVxuXG4gIGlmIChoZWlnaHQpIHtcbiAgICBoID0gaGVpZ2h0O1xuICB9IGVsc2Uge1xuICAgIC8vIERldGVybWluZSBoZWlnaHRcbiAgICBkb2NIZWlnaHQgPSBNYXRoLm1heChcbiAgICAgIGNvbnRhaW5lci5zY3JvbGxIZWlnaHQsIGRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5zY3JvbGxIZWlnaHQsXG4gICAgICBjb250YWluZXIub2Zmc2V0SGVpZ2h0LCBkb2N1bWVudC5kb2N1bWVudEVsZW1lbnQub2Zmc2V0SGVpZ2h0LFxuICAgICAgY29udGFpbmVyLmNsaWVudEhlaWdodCwgZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodFxuICAgICk7XG5cbiAgICBpZihjb250YWluZXIgPT09IGRvY3VtZW50LmJvZHkpe1xuICAgICAgaCA9IGRvY0hlaWdodDtcbiAgICB9IGVsc2Uge1xuICAgICAgLy8gU3RhcnRlZCB3aXRoIGh0dHA6Ly9qYW1lcy5wYWRvbHNleS5jb20vamF2YXNjcmlwdC9nZXQtZG9jdW1lbnQtaGVpZ2h0LWNyb3NzLWJyb3dzZXIvXG4gICAgICAvLyB0byBkZXRlcm1pbmUgcGFnZSBoZWlnaHQgYWNyb3NzIGJyb3dzZXJzLiBUdXJucyBvdXQgdGhhdCBpbiBvdXIgY2FzZSwgd2UgY2FuIGdldCBieSB3aXRoXG4gICAgICAvLyBkb2N1bWVudC5ib2R5Lm9mZnNldEhlaWdodCBhbmQgZG9jdW1lbnQuYm9keS5jbGllbnRIZWlnaHQuIFRob3NlIHR3byByZXR1cm4gdGhlIHByb3BlclxuICAgICAgLy8gaGVpZ2h0IGV2ZW4gd2hlbiB0aGUgZG9tIHNocmlua3MuIFRlc3RlZCBvbiBDaHJvbWUsIFNhZmFyaSwgSUU4LzkvMTAsIGFuZCBGaXJlZm94XG4gICAgICBoID0gTWF0aC5tYXgoY29udGFpbmVyLm9mZnNldEhlaWdodCwgY29udGFpbmVyLmNsaWVudEhlaWdodCk7XG4gICAgICBpZihoID09PSAwKXtcbiAgICAgICAgaCA9IGRvY0hlaWdodDtcbiAgICAgIH1cbiAgICB9XG4gIH1cbiAgcmV0dXJuIHt3OiB3LCBoOiBofTtcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gc2l6ZTsiXX0=
